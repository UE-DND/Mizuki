---
import MainGridLayout from "@layouts/MainGridLayout.astro";
import { Icon } from "astro-icon/components";
import { getResolvedSiteSettings } from "@/server/site-settings/service";

export const prerender = false;

const resolvedSettings =
  Astro.locals.siteSettings ?? (await getResolvedSiteSettings());
const registerEnabled = Boolean(
  resolvedSettings.settings.auth?.register_enabled,
);
if (!registerEnabled) {
  return Astro.rewrite("/404");
}
---

<MainGridLayout title="注册申请" description="提交注册申请，等待管理员审批">
  <div
    data-enter-skeleton-page="auth-register"
    data-enter-skeleton-target="auth-register"
  >
    <div data-enter-skeleton-inline-content>
      <div class="card-base rounded-(--radius-large) p-6 md:p-8 space-y-5">
        <div class="flex items-center gap-3">
          <div
            class="w-12 h-12 rounded-2xl bg-(--btn-regular-bg) flex items-center justify-center"
          >
            <Icon
              name="material-symbols:person-add-rounded"
              class="text-(--btn-content) text-3xl"
            />
          </div>
          <div>
            <h1 class="text-2xl font-bold text-90">注册申请</h1>
            <p class="text-sm text-75">
              提交后进入审核流程，审批通过后由管理员创建账号。
            </p>
          </div>
        </div>

        <form id="register-form" class="space-y-4">
          <label class="block space-y-1">
            <span class="text-sm text-70">邮箱</span>
            <input
              id="register-email"
              type="email"
              required
              autocomplete="email"
              class="w-full rounded-lg border border-(--line-divider) px-3 py-2.5 bg-transparent text-75"
              placeholder="name@example.com"
            />
          </label>
          <label class="block space-y-1">
            <span class="text-sm text-70">用户名</span>
            <input
              id="register-username"
              required
              pattern="[A-Za-z0-9_-]+"
              title="仅支持英文、数字、下划线和短横线"
              class="w-full rounded-lg border border-(--line-divider) px-3 py-2.5 bg-transparent text-75"
              placeholder="mizuki_user"
            />
          </label>
          <label class="block space-y-1">
            <span class="text-sm text-70">昵称</span>
            <input
              id="register-display-name"
              required
              class="w-full rounded-lg border border-(--line-divider) px-3 py-2.5 bg-transparent text-75"
              placeholder="显示昵称"
            />
          </label>
          <div class="space-y-2">
            <span class="text-sm text-70">头像（可选）</span>
            <div class="flex items-center gap-4">
              <img
                id="register-avatar-preview"
                class="w-20 h-20 rounded-full object-cover border border-(--line-divider) bg-black/10 dark:bg-white/10"
                alt="申请头像预览"
                loading="lazy"
              />
              <div class="flex flex-wrap gap-2">
                <button
                  type="button"
                  id="register-avatar-upload-btn"
                  class="px-4 h-9 rounded-lg text-sm font-medium cursor-pointer bg-(--primary) text-white hover:opacity-90 transition"
                >
                  上传头像
                </button>
                <button
                  type="button"
                  id="register-avatar-clear-btn"
                  class="px-4 h-9 rounded-lg text-sm border border-(--line-divider) text-75"
                >
                  清空
                </button>
              </div>
            </div>
          </div>
          <label class="block space-y-1">
            <span class="text-sm text-70">注册理由</span>
            <textarea
              id="register-reason"
              required
              rows="4"
              maxlength="500"
              class="w-full rounded-lg border border-(--line-divider) px-3 py-2.5 bg-transparent text-75 resize-none"
              placeholder="请简单介绍你的用途或申请理由"></textarea>
          </label>
          <div id="register-message" class="text-sm text-70 hidden"></div>
          <button
            id="register-submit"
            type="submit"
            class="w-full px-4 py-2.5 rounded-lg bg-(--btn-regular-bg) text-(--btn-content) text-sm font-semibold"
          >
            <span id="register-submit-text">提交申请</span>
          </button>
        </form>

        <p class="text-sm text-70">
          已有账号？
          <a class="text-(--primary) hover:underline" href="/auth/login">
            前往登录
          </a>
        </p>
      </div>
    </div>
    <div data-enter-skeleton-inline-placeholder aria-hidden="true">
      <div class="card-base rounded-(--radius-large) p-6 md:p-8 space-y-5">
        <div class="flex items-center gap-3">
          <div class="md3-skeleton-block w-12 h-12 rounded-2xl"></div>
          <div class="space-y-2 flex-1">
            <div
              class="md3-skeleton-text"
              style="--skeleton-width: 26%; --skeleton-height: 1.6rem;"
            >
            </div>
            <div
              class="md3-skeleton-text"
              style="--skeleton-width: 56%; --skeleton-height: 0.82rem;"
            >
            </div>
          </div>
        </div>
        <div class="space-y-4">
          <div class="space-y-2">
            <div
              class="md3-skeleton-text"
              style="--skeleton-width: 12%; --skeleton-height: 0.82rem;"
            >
            </div>
            <div class="md3-skeleton-block h-11 rounded-lg"></div>
          </div>
          <div class="space-y-2">
            <div
              class="md3-skeleton-text"
              style="--skeleton-width: 14%; --skeleton-height: 0.82rem;"
            >
            </div>
            <div class="md3-skeleton-block h-11 rounded-lg"></div>
          </div>
          <div class="space-y-2">
            <div
              class="md3-skeleton-text"
              style="--skeleton-width: 10%; --skeleton-height: 0.82rem;"
            >
            </div>
            <div class="md3-skeleton-block h-11 rounded-lg"></div>
          </div>
          <div class="space-y-2">
            <div
              class="md3-skeleton-text"
              style="--skeleton-width: 18%; --skeleton-height: 0.82rem;"
            >
            </div>
            <div class="flex items-center gap-4">
              <div class="md3-skeleton-circle w-20 h-20"></div>
              <div class="flex flex-wrap gap-2">
                <div class="md3-skeleton-block h-9 w-22 rounded-lg"></div>
                <div class="md3-skeleton-block h-9 w-16 rounded-lg"></div>
              </div>
            </div>
          </div>
          <div class="space-y-2">
            <div
              class="md3-skeleton-text"
              style="--skeleton-width: 16%; --skeleton-height: 0.82rem;"
            >
            </div>
            <div class="md3-skeleton-block h-28 rounded-lg"></div>
          </div>
          <div class="md3-skeleton-block h-11 rounded-xl"></div>
          <div
            class="md3-skeleton-text"
            style="--skeleton-width: 30%; --skeleton-height: 0.82rem;"
          >
          </div>
        </div>
      </div>
    </div>
  </div>

  <div
    slot="modal"
    id="register-avatar-crop-modal"
    class="fixed inset-0 z-9999 hidden items-center justify-center bg-black/70 px-4 py-5"
    tabindex="-1"
  >
    <div
      class="card-base w-full max-w-xl rounded-(--radius-large) border border-(--line-divider) p-5 sm:p-6 space-y-4 text-75"
    >
      <div class="flex items-center gap-2">
        <h3 class="text-lg sm:text-xl font-semibold text-90">裁剪头像</h3>
      </div>
      <p class="text-sm text-60">建议使用方形图片，拖拽调整位置并缩放。</p>
      <div
        id="register-avatar-crop-viewport"
        class="relative mx-auto w-full max-w-[360px] aspect-square overflow-hidden rounded-2xl border border-(--line-divider) bg-black/15 dark:bg-white/10 select-none touch-none"
      >
        <img
          id="register-avatar-crop-image"
          class="absolute left-0 top-0 max-w-none pointer-events-none hidden"
          alt="待裁剪头像"
        />
        <div
          id="register-avatar-crop-empty"
          class="absolute inset-0 grid place-items-center text-sm text-60 pointer-events-none"
        >
          请选择图片
        </div>
        <div
          class="absolute inset-0 pointer-events-none rounded-2xl ring-2 ring-white/80"
        >
        </div>
      </div>
      <div class="space-y-1">
        <label for="register-avatar-crop-zoom" class="text-sm text-60">
          缩放
        </label>
        <input
          id="register-avatar-crop-zoom"
          type="range"
          min="100"
          max="300"
          step="1"
          value="100"
          class="w-full"
        />
      </div>
      <div class="flex flex-wrap items-center gap-3">
        <input
          id="register-avatar-crop-file"
          type="file"
          accept="image/*"
          class="hidden"
        />
        <button
          type="button"
          id="register-avatar-crop-select-btn"
          class="px-4 h-9 rounded-lg text-sm font-medium cursor-pointer bg-(--primary) text-white hover:opacity-90 transition"
        >
          选择文件
        </button>
        <button
          type="button"
          id="register-avatar-crop-apply-btn"
          class="px-4 py-2.5 rounded-lg bg-(--btn-regular-bg) text-(--btn-content) text-sm"
        >
          确认裁剪
        </button>
        <button
          type="button"
          id="register-avatar-crop-cancel-btn"
          class="ml-auto px-4 py-2.5 rounded-lg border border-(--line-divider) text-sm text-75"
        >
          取消
        </button>
      </div>
      <span id="register-avatar-crop-msg" class="text-sm text-red-500"></span>
    </div>
  </div>

  <script is:inline>
    const API_REGISTER = "/api/v1/public/registration-requests";
    const API_UPLOAD = "/api/v1/uploads";
    const DATA_BOUND = "data-register-bound";
    const AVATAR_OUTPUT_SIZE = 512;
    const AVATAR_ZOOM_MIN = 100;
    const AVATAR_ZOOM_MAX = 300;
    const EMPTY_AVATAR_SRC =
      "data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='128' height='128'%3E%3Crect width='128' height='128' fill='%23d1d5db'/%3E%3C/svg%3E";

    function setPageMessage(message, tone = "normal") {
      const messageEl = document.getElementById("register-message");
      if (!messageEl) {
        return;
      }
      if (!message) {
        messageEl.classList.add("hidden");
        messageEl.textContent = "";
        messageEl.classList.remove("text-red-500", "text-emerald-600");
        messageEl.classList.add("text-70");
        return;
      }
      messageEl.classList.remove("hidden", "text-red-500", "text-emerald-600");
      messageEl.classList.add(
        tone === "error" ? "text-red-500" : "text-emerald-600",
      );
      messageEl.textContent = message;
    }

    function buildAssetUrl(fileId) {
      const normalized = String(fileId || "").trim();
      if (!normalized) {
        return "";
      }
      return `/api/v1/public/assets/${encodeURIComponent(normalized)}?width=160&height=160&fit=cover`;
    }

    function resolveRegisterError(data) {
      const code = String(data?.code || "");
      if (code === "REGISTER_DISABLED") {
        return "注册入口未开启";
      }
      if (code === "EMAIL_EXISTS") {
        return "邮箱已存在";
      }
      if (code === "USERNAME_EXISTS") {
        return "用户名已存在";
      }
      if (code === "REGISTRATION_REQUEST_EXISTS") {
        return "该邮箱或用户名已有待处理申请";
      }
      if (code === "REGISTRATION_STATUS_CONFLICT") {
        return "申请状态已变更，请刷新列表";
      }
      return String(data?.message || "提交失败");
    }

    async function initRegisterPage() {
      const form = document.getElementById("register-form");
      if (!form || form.hasAttribute(DATA_BOUND)) {
        return;
      }

      const emailEl = document.getElementById("register-email");
      const usernameEl = document.getElementById("register-username");
      const displayNameEl = document.getElementById("register-display-name");
      const reasonEl = document.getElementById("register-reason");
      const submitBtn = document.getElementById("register-submit");
      const submitText = document.getElementById("register-submit-text");
      const avatarPreviewEl = document.getElementById(
        "register-avatar-preview",
      );
      const avatarUploadBtn = document.getElementById(
        "register-avatar-upload-btn",
      );
      const avatarClearBtn = document.getElementById(
        "register-avatar-clear-btn",
      );
      const cropModal = document.getElementById("register-avatar-crop-modal");
      const cropViewport = document.getElementById(
        "register-avatar-crop-viewport",
      );
      const cropImage = document.getElementById("register-avatar-crop-image");
      const cropEmpty = document.getElementById("register-avatar-crop-empty");
      const cropFileInput = document.getElementById(
        "register-avatar-crop-file",
      );
      const cropSelectBtn = document.getElementById(
        "register-avatar-crop-select-btn",
      );
      const cropApplyBtn = document.getElementById(
        "register-avatar-crop-apply-btn",
      );
      const cropCancelBtn = document.getElementById(
        "register-avatar-crop-cancel-btn",
      );
      const cropZoomInput = document.getElementById(
        "register-avatar-crop-zoom",
      );
      const cropMsg = document.getElementById("register-avatar-crop-msg");

      if (
        !emailEl ||
        !usernameEl ||
        !displayNameEl ||
        !reasonEl ||
        !submitBtn ||
        !submitText ||
        !avatarPreviewEl ||
        !avatarUploadBtn ||
        !avatarClearBtn ||
        !cropModal ||
        !cropViewport ||
        !cropImage ||
        !cropEmpty ||
        !cropFileInput ||
        !cropSelectBtn ||
        !cropApplyBtn ||
        !cropCancelBtn ||
        !cropZoomInput ||
        !cropMsg
      ) {
        window.setTimeout(() => {
          if (!form.hasAttribute(DATA_BOUND)) {
            void initRegisterPage();
          }
        }, 0);
        return;
      }
      form.setAttribute(DATA_BOUND, "1");

      avatarPreviewEl.src = EMPTY_AVATAR_SRC;

      let avatarFileId = "";
      let avatarUploading = false;
      let cropObjectUrl = "";
      let cropLoaded = false;
      let cropImageWidth = 0;
      let cropImageHeight = 0;
      let cropViewportSize = 0;
      let cropMinScale = 1;
      let cropScale = 1;
      let cropOffsetX = 0;
      let cropOffsetY = 0;
      let cropPointerId = null;
      let cropPointerX = 0;
      let cropPointerY = 0;

      const clamp = (value, min, max) => Math.min(max, Math.max(min, value));

      const setCropMessage = (message) => {
        cropMsg.textContent = String(message || "");
      };

      const setCropApplyState = () => {
        cropApplyBtn.disabled = !cropLoaded || avatarUploading;
        cropApplyBtn.textContent = avatarUploading ? "上传中..." : "确认裁剪";
      };

      const setCropEmptyVisible = (visible) => {
        cropEmpty.classList.toggle("hidden", !visible);
      };

      const revokeCropObjectUrl = () => {
        if (!cropObjectUrl) {
          return;
        }
        URL.revokeObjectURL(cropObjectUrl);
        cropObjectUrl = "";
      };

      const resetCropState = () => {
        revokeCropObjectUrl();
        cropLoaded = false;
        cropImageWidth = 0;
        cropImageHeight = 0;
        cropViewportSize = 0;
        cropMinScale = 1;
        cropScale = 1;
        cropOffsetX = 0;
        cropOffsetY = 0;
        cropPointerId = null;
        cropPointerX = 0;
        cropPointerY = 0;
        cropImage.removeAttribute("src");
        cropImage.classList.add("hidden");
        cropImage.style.transform = "";
        cropImage.style.width = "";
        cropImage.style.height = "";
        cropZoomInput.value = String(AVATAR_ZOOM_MIN);
        setCropMessage("");
        setCropEmptyVisible(true);
        setCropApplyState();
      };

      const openCropModal = () => {
        cropModal.classList.remove("hidden");
        cropModal.classList.add("flex");
        cropModal.focus();
        resetCropState();
      };

      const closeCropModal = () => {
        cropModal.classList.remove("flex");
        cropModal.classList.add("hidden");
        cropFileInput.value = "";
        resetCropState();
      };

      const measureViewport = () => {
        const rect = cropViewport.getBoundingClientRect();
        return Math.min(rect.width, rect.height);
      };

      const clampCropOffset = () => {
        if (!cropLoaded || cropViewportSize <= 0) {
          return;
        }
        const scaledWidth = cropImageWidth * cropScale;
        const scaledHeight = cropImageHeight * cropScale;
        const minX = cropViewportSize - scaledWidth;
        const minY = cropViewportSize - scaledHeight;
        cropOffsetX = clamp(cropOffsetX, minX, 0);
        cropOffsetY = clamp(cropOffsetY, minY, 0);
      };

      const renderCropImage = () => {
        if (!cropLoaded) {
          cropImage.classList.add("hidden");
          setCropEmptyVisible(true);
          return;
        }
        clampCropOffset();
        cropImage.classList.remove("hidden");
        cropImage.style.width = `${cropImageWidth}px`;
        cropImage.style.height = `${cropImageHeight}px`;
        cropImage.style.transform = `translate3d(${cropOffsetX}px, ${cropOffsetY}px, 0) scale(${cropScale})`;
        cropImage.style.transformOrigin = "top left";
        setCropEmptyVisible(false);
      };

      const setCropScaleFromZoom = (zoomValue, anchorX, anchorY) => {
        if (!cropLoaded || cropViewportSize <= 0) {
          return;
        }
        const normalizedZoom = clamp(
          Number.isFinite(Number(zoomValue))
            ? Number(zoomValue)
            : AVATAR_ZOOM_MIN,
          AVATAR_ZOOM_MIN,
          AVATAR_ZOOM_MAX,
        );
        const nextScale = cropMinScale * (normalizedZoom / 100);
        const safeAnchorX = clamp(anchorX, 0, cropViewportSize);
        const safeAnchorY = clamp(anchorY, 0, cropViewportSize);
        const imagePointX = (safeAnchorX - cropOffsetX) / cropScale;
        const imagePointY = (safeAnchorY - cropOffsetY) / cropScale;
        cropScale = nextScale;
        cropOffsetX = safeAnchorX - imagePointX * cropScale;
        cropOffsetY = safeAnchorY - imagePointY * cropScale;
        clampCropOffset();
        renderCropImage();
        cropZoomInput.value = String(Math.round(normalizedZoom));
      };

      const loadCropFile = (file) => {
        if (!file) {
          setCropMessage("请选择图片");
          return;
        }
        if (file.size > 1.5 * 1024 * 1024) {
          setCropMessage("头像文件不能超过 1.5 MB");
          return;
        }
        setCropMessage("");
        const nextObjectUrl = URL.createObjectURL(file);
        cropImage.onload = () => {
          cropLoaded = true;
          cropImageWidth = Math.max(1, cropImage.naturalWidth);
          cropImageHeight = Math.max(1, cropImage.naturalHeight);
          cropViewportSize = measureViewport() || 320;
          cropMinScale = Math.max(
            cropViewportSize / cropImageWidth,
            cropViewportSize / cropImageHeight,
          );
          cropScale = cropMinScale;
          cropOffsetX = (cropViewportSize - cropImageWidth * cropScale) / 2;
          cropOffsetY = (cropViewportSize - cropImageHeight * cropScale) / 2;
          cropZoomInput.value = String(AVATAR_ZOOM_MIN);
          renderCropImage();
          setCropApplyState();
        };
        cropImage.onerror = () => {
          setCropMessage("图片读取失败，请重试");
          resetCropState();
        };
        revokeCropObjectUrl();
        cropObjectUrl = nextObjectUrl;
        cropImage.src = nextObjectUrl;
      };

      const buildCropBlob = async () => {
        if (!cropLoaded || cropViewportSize <= 0) {
          return null;
        }
        const canvas = document.createElement("canvas");
        canvas.width = AVATAR_OUTPUT_SIZE;
        canvas.height = AVATAR_OUTPUT_SIZE;
        const context = canvas.getContext("2d");
        if (!context) {
          return null;
        }
        const ratio = AVATAR_OUTPUT_SIZE / cropViewportSize;
        context.imageSmoothingEnabled = true;
        context.imageSmoothingQuality = "high";
        context.clearRect(0, 0, canvas.width, canvas.height);
        context.drawImage(
          cropImage,
          cropOffsetX * ratio,
          cropOffsetY * ratio,
          cropImageWidth * cropScale * ratio,
          cropImageHeight * cropScale * ratio,
        );
        return await new Promise((resolve) => {
          canvas.toBlob((blob) => resolve(blob), "image/png");
        });
      };

      const uploadCroppedAvatar = async (blob) => {
        const formData = new FormData();
        formData.append("file", blob, "registration-avatar.png");
        formData.append("title", "Registration Avatar");
        formData.append("purpose", "registration-avatar");
        const response = await fetch(API_UPLOAD, {
          method: "POST",
          credentials: "include",
          body: formData,
        });
        const data = await response.json().catch(() => null);
        if (!response.ok || !data?.ok || !data?.file?.id) {
          throw new Error(resolveRegisterError(data));
        }
        return String(data.file.id);
      };

      const applyCrop = async () => {
        if (!cropLoaded || avatarUploading) {
          return;
        }
        avatarUploading = true;
        setCropApplyState();
        try {
          const blob = await buildCropBlob();
          if (!blob) {
            setCropMessage("裁剪失败，请重试");
            return;
          }
          const fileId = await uploadCroppedAvatar(blob);
          avatarFileId = fileId;
          avatarPreviewEl.src = buildAssetUrl(fileId) || EMPTY_AVATAR_SRC;
          closeCropModal();
        } catch (error) {
          setCropMessage(
            error instanceof Error ? error.message : "头像上传失败",
          );
        } finally {
          avatarUploading = false;
          setCropApplyState();
        }
      };

      avatarUploadBtn.addEventListener("click", openCropModal);
      avatarClearBtn.addEventListener("click", () => {
        avatarFileId = "";
        avatarPreviewEl.src = EMPTY_AVATAR_SRC;
      });
      cropSelectBtn.addEventListener("click", () => cropFileInput.click());
      cropFileInput.addEventListener("change", () => {
        const file = cropFileInput.files?.[0];
        if (file) {
          loadCropFile(file);
        }
      });
      cropZoomInput.addEventListener("input", () => {
        const center = cropViewportSize > 0 ? cropViewportSize / 2 : 0;
        setCropScaleFromZoom(cropZoomInput.value, center, center);
      });
      cropApplyBtn.addEventListener("click", () => void applyCrop());
      cropCancelBtn.addEventListener("click", () => {
        if (!avatarUploading) {
          closeCropModal();
        }
      });
      cropModal.addEventListener("click", (event) => {
        if (!avatarUploading && event.target === cropModal) {
          closeCropModal();
        }
      });
      cropModal.addEventListener("keydown", (event) => {
        if (event.key === "Escape" && !avatarUploading) {
          closeCropModal();
        }
      });
      cropViewport.addEventListener("pointerdown", (event) => {
        if (!cropLoaded) {
          return;
        }
        cropPointerId = event.pointerId;
        cropPointerX = event.clientX;
        cropPointerY = event.clientY;
        cropViewport.setPointerCapture(event.pointerId);
      });
      cropViewport.addEventListener("pointermove", (event) => {
        if (!cropLoaded || cropPointerId !== event.pointerId) {
          return;
        }
        const deltaX = event.clientX - cropPointerX;
        const deltaY = event.clientY - cropPointerY;
        cropPointerX = event.clientX;
        cropPointerY = event.clientY;
        cropOffsetX += deltaX;
        cropOffsetY += deltaY;
        renderCropImage();
      });
      const releasePointer = (event) => {
        if (cropPointerId !== event.pointerId) {
          return;
        }
        if (cropViewport.hasPointerCapture(event.pointerId)) {
          cropViewport.releasePointerCapture(event.pointerId);
        }
        cropPointerId = null;
      };
      cropViewport.addEventListener("pointerup", releasePointer);
      cropViewport.addEventListener("pointercancel", releasePointer);

      form.addEventListener("submit", async (event) => {
        event.preventDefault();
        setPageMessage("");

        const payload = {
          email: String(emailEl.value || "").trim(),
          username: String(usernameEl.value || "").trim(),
          display_name: String(displayNameEl.value || "").trim(),
          registration_reason: String(reasonEl.value || "").trim(),
          avatar_file: avatarFileId || null,
        };

        if (
          !payload.email ||
          !payload.username ||
          !payload.display_name ||
          !payload.registration_reason
        ) {
          setPageMessage("请完整填写申请信息", "error");
          return;
        }

        submitBtn.disabled = true;
        submitText.textContent = "提交中...";
        try {
          const response = await fetch(API_REGISTER, {
            method: "POST",
            credentials: "include",
            headers: {
              "Content-Type": "application/json",
              Accept: "application/json",
            },
            body: JSON.stringify(payload),
          });
          const data = await response.json().catch(() => null);
          if (!response.ok || !data?.ok) {
            setPageMessage(resolveRegisterError(data), "error");
            return;
          }
          setPageMessage("申请已提交，请等待管理员审核", "success");
          form.reset();
          avatarFileId = "";
          avatarPreviewEl.src = EMPTY_AVATAR_SRC;
        } catch (error) {
          setPageMessage(
            error instanceof Error ? error.message : "提交失败，请稍后重试",
            "error",
          );
        } finally {
          submitBtn.disabled = false;
          submitText.textContent = "提交申请";
        }
      });
    }

    initRegisterPage();
    document.addEventListener("astro:after-swap", initRegisterPage);
  </script>
</MainGridLayout>
