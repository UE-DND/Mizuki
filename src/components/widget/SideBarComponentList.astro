---
import type { MarkdownHeading } from "astro";
import type { WidgetComponentConfig } from "@/types/config";
import { widgetManager } from "../../utils/widget-manager";
import Announcement from "./Announcement.astro";
import Calendar from "./Calendar.astro";
import Categories from "./Categories.astro";
import MusicPlayer from "./MusicPlayer.svelte";
import Profile from "./Profile.astro";
import SiteStats from "./SiteStats.astro";
import Tags from "./Tags.astro";
import TOC from "./TOC.astro";

interface Props {
	components: WidgetComponentConfig[];
	headings?: MarkdownHeading[];
}

const { components, headings } = Astro.props;

const componentMap = {
	profile: Profile,
	announcement: Announcement,
	categories: Categories,
	tags: Tags,
	"music-player": MusicPlayer,
	"site-stats": SiteStats,
	calendar: Calendar,
} as const;
---

{
	components.map((component, index) => {
		const componentClass = widgetManager.getComponentClass(component, index);
		const componentStyle = widgetManager.getComponentStyle(component, index);

		if (component.type === "toc") {
			return (
				<TOC
					class={componentClass}
					style={componentStyle}
					headings={headings ?? []}
					{...(component.customProps ?? {})}
				/>
			);
		}

		const ComponentToRender =
			componentMap[component.type as keyof typeof componentMap];
		if (!ComponentToRender) {
			return null;
		}

		const props = {
			class: componentClass,
			style: componentStyle,
			...(component.customProps ?? {}),
		};

		return <ComponentToRender {...props} />;
	})
}
